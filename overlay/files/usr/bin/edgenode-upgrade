#!/bin/sh

# Load OS Metadata
. /etc/os-release

release_channel=${IMAGE_LABEL}

while [ "$#" -gt 0 ]; do
  case $1 in
    --system.uri)
        shift 1
        system_uri=$1
        ;;
    --release-channel)
        shift 1
        release_channel=$1
        ;;
    *)
        if [ "$#" -gt 2 ]; then
            elemental upgrade --help
        fi
        break
        ;;
  esac
  shift 1
done

if [ -z "${system_uri}" ]
then
  upgrade_uri=${IMAGE_REPO}:${release_channel}
else
  upgrade_uri=${system_uri}
fi

elemental upgrade --system.uri $upgrade_uri $@
